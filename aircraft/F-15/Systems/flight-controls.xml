<system  name="FCS F15">
<!-- F-15 Flight controls 
   |  Richard Harrison: 2014-11-23 : rjh@zaretto.com - based on F-14 
   Longitudinal travel: -10 to 15cm
-->
    <property value="1">gear/serviceable</property>
    <property value="0">systems/hydraulics/emerg-gear-bleed</property>
    <property value="0">gear/damage-reset</property>
    <property value="2">position/aircraft-on-ground-last-value</property>
    
    <channel name="Pitch">
        <switch name="fcs/ari-lateral-enabled">
            <default value="1"/>
            <test value="0" logic="OR">
                systems/hydraulics/flight-system-pressure ne 1
                autoflight/input/pitch-switch ne 1
            </test>
        </switch>

        <switch name="fcs/stick-pitch">
			<default value="0"/>
			<test value="fcs/elevator-cmd-norm">
				autoflight/input/pitch-switch ne 1
			</test>
		</switch>
		
		<switch name="fcs/css-pitch">
			<default value="0"/>
			<test logic="AND" value="autoflight/ss/elevator-norm">
				autoflight/input/pitch-switch eq 1
				autoflight/ss/elevator-norm ne 0
			</test>
		</switch>

        <!--A Comparison of Control Allocation Methods for the F-15 ACTIVE Research Aircraft Utilizing Real-Time Piloted Simulations
            Kevin R. Scalera
        Table 2.1: Control surface limits
        Control Effector Deflection (deg) Rate Limit (deg/s)
                DHT(L/R) -29.0 / 15.0 ±46
                DAIL(L/R) -20.0 / 20.0 ±100
                DRUD(L/R) -30.0 / 30.0 ±105
                FLAPS(L/R) 0.0 / 35.0 ±18
        -->
        <summer name="Pitch Trim Sum">
            <input>fcs/stick-pitch</input>
            <input>fcs/css-pitch</input>
            <input>fcs/pitch-trim-cmd-norm</input>
            <input>fcs/pitch-damper-rate</input>
            <input>autoflight/pitch/pitch-rate-demand</input>
            <input>systems/cadc/pitch-trim-compensation</input>
            <clipto>
                <min> -1 </min>
                <max>  1 </max>
            </clipto>
        </summer>

        <switch name="fcs/pitch-trim-actuator">
            <default value="fcs/pitch-trim-sum"/>
        </switch>

        <aerosurface_scale name="Elevator Control">
            <input>fcs/pitch-trim-actuator</input>
            <!-- maybe this should take into account the trim limits from the AAP -->
            <range>
                <min> -0.50877 </min>
                <max>  0.26315 </max>
            </range>
            <output>fcs/elevator-pos-raw-demand</output>
        </aerosurface_scale>

        <pure_gain name="tied/fcs-elevator-control">
            <input>fcs/elevator-pos-raw-demand</input>
            <gain>systems/cadc/pitch-ratio</gain>
            <output>fcs/elevator-pos-demand</output>
        </pure_gain >

        <kinematic name="tied/fcs-elevator-position">
            <input>fcs/elevator-pos-demand</input>
            <traverse>
                <setting>
                    <position>-1</position>
                    <time>0.6304</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.3260</time>
                </setting>
            </traverse>
            <output>fcs/elevator-pos-rad</output>
        </kinematic>

        <!-- dtd is washed out with elevator position http://www.f15sim.com/operation/f15_lat_control.html -->
        <fcs_function name="fcs/differential-elevator-pos-norm">
            <function>
                <product>
                    <property>fcs/aileron-pos-norm</property>
                    <value>0.3</value> <!-- mxaimum authority -->
                    <table>
                        <!-- Figure 4 Mechanmical lateral control authority.
      ** iv; Vc Kts
      ** stabilator maximum
      ** dv: full stock aileron deflection degrees
-->
                        <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <independentVar lookup="column">velocities/vc-kts</independentVar>
                        <tableData>
                            635.0	664.3	668.2	714.8	741.3	768.0	794.7
                        -24	0.16	0.16	0.16	0.16	0.16	0.16	0.16
                        -23	0.16	0.16	0.16	0.16	0.16	0.16	0.16
                        -22	0.16	0.16	0.16	0.16	0.16	0.15	0.16
                        -21	0.16	0.16	0.16	0.16	0.16	0.15	0.16
                        -20	0.16	0.16	0.16	0.16	0.16	0.15	0.16
                        -19	0.16	0.16	0.16	0.16	0.16	0.15	0.16
                        -18	0.19	0.19	0.20	0.20	0.19	0.19	0.19
                        -17	0.29	0.30	0.30	0.30	0.30	0.29	0.24
                        -16	0.39	0.40	0.40	0.40	0.40	0.38	0.24
                        -15	0.50	0.50	0.51	0.50	0.50	0.38	0.24
                        -14	0.60	0.60	0.61	0.61	0.50	0.38	0.24
                        -13	0.70	0.70	0.71	0.63	0.50	0.38	0.24
                        -12	0.80	0.81	0.75	0.63	0.50	0.38	0.24
                        -11	0.91	0.87	0.75	0.63	0.50	0.38	0.25
                        -10	1.00	0.87	0.75	0.63	0.50	0.38	0.25
                        -9	1.00	0.87	0.75	0.63	0.50	0.38	0.25
                        -8	1.00	0.87	0.75	0.63	0.50	0.38	0.25
                        -7	1.00	0.88	0.75	0.63	0.50	0.38	0.25
                        -6	1.00	0.88	0.75	0.63	0.50	0.38	0.25
                        -5	1.00	0.88	0.75	0.63	0.50	0.38	0.25
                        -4	0.90	0.88	0.75	0.63	0.50	0.38	0.25
                        -3	0.79	0.80	0.75	0.63	0.50	0.38	0.25
                        -2	0.69	0.69	0.69	0.63	0.50	0.38	0.25
                        -1	0.58	0.59	0.59	0.59	0.50	0.38	0.25
                        0	0.47	0.49	0.48	0.49	0.48	0.38	0.25
                        1	0.37	0.39	0.38	0.40	0.38	0.38	0.25
                        2	0.26	0.28	0.27	0.30	0.28	0.28	0.25
                        3	0.25	0.25	0.24	0.25	0.25	0.24	0.25
                        4	0.25	0.25	0.24	0.25	0.24	0.24	0.25
                        5	0.25	0.25	0.24	0.25	0.24	0.24	0.25
                        6	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        7	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        8	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        9	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        10	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        11	0.24	0.25	0.24	0.25	0.24	0.24	0.25
                        12	0.24	0.24	0.24	0.24	0.24	0.24	0.25
                        13	0.24	0.24	0.24	0.24	0.24	0.24	0.25
                        14	0.24	0.24	0.24	0.24	0.24	0.24	0.25
                        15	0.24	0.24	0.24	0.24	0.24	0.24	0.24
                        16	0.24	0.24	0.24	0.24	0.24	0.24	0.24
                        </tableData>
                        <!--<independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <tableData>
                            -24     0
                              0     0.3
                             16     0
                        </tableData>-->
                    </table>
                </product>
            </function>
        </fcs_function>

        <aerosurface_scale name="fcs/differential-elevator-pos-deg">
            <input>fcs/differential-elevator-pos-norm</input>
            <domain>
                <min>  -1 </min>
                <max>   1 </max>
            </domain>
            <range>
                <min> -6.66667 </min>
                <max>  6.66667 </max>
            </range>
        </aerosurface_scale>

        <aerosurface_scale name="elevator normalization">
            <input>fcs/elevator-pos-rad</input>
            <domain>
                <min>  -0.57895 </min>
                <max>   0.21053 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max>  1 </max>
            </range>
            <output>fcs/elevator-pos-norm</output>
        </aerosurface_scale>
    </channel>


    <!-- aileron: +/- 5deg : +/- 33 deg/sec -->
    <channel name="Roll">
        <switch name="fcs/stick-roll">
            <default value="0"/>
            <test value="fcs/aileron-cmd-norm">
                autoflight/input/roll-switch ne 1
            </test>
        </switch>

        <switch name="fcs/css-roll">
            <default value="0"/>
            <test logic="AND" value="autoflight/ss/aileron-norm">
                autoflight/input/roll-switch eq 1
                autoflight/ss/aileron-norm ne 0
            </test>
        </switch>

        <summer name="fcs/roll-trim-sum-raw">
            <input>fcs/stick-roll</input>
            <input>fcs/css-roll</input>
            <input>fcs/roll-trim-cmd-norm</input>
            <input>autoflight/roll/roll-rate-demand</input>
            <input>fcs/roll-rate-limiter</input>
            <clipto>
                <min> -1 </min>
                <max>  1 </max>
            </clipto>
        </summer>

        <pure_gain name="fcs/roll-trim-sum-norm">
            <input>fcs/roll-trim-sum-raw</input>
            <gain>systems/cadc/roll-ratio</gain>
        </pure_gain >

        <switch name="fcs/roll-trim-actuator-norm">
            <default value="fcs/roll-trim-sum-norm"/>
        </switch>

        <kinematic name="aileron position">
            <input>fcs/roll-trim-actuator-norm</input>
            <traverse>
                <setting>
                    <position>-1</position>
                    <time>0.2</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.2</time>
                </setting>
            </traverse>
            <output>fcs/aileron-pos-norm</output>
        </kinematic>

        <pure_gain name="tied/fcs-left-aileron-pos-norm">
            <input>fcs/aileron-pos-norm</input>
            <gain>1</gain>
            <output>fcs/left-aileron-pos-norm</output>
        </pure_gain >
        <pure_gain name="tied/fcs-right-aileron-pos-norm">
            <input>fcs/aileron-pos-norm</input>
            <gain>1</gain>
            <output>fcs/right-aileron-pos-norm</output>
        </pure_gain >

        <aerosurface_scale name="Aileron Control">
            <input>fcs/aileron-pos-norm</input>
            <range>
                <min> -20 </min>
                <max>  20 </max>
            </range>
            <output>fcs/aileron-pos-deg</output>
        </aerosurface_scale>
    </channel>

    <channel name="Yaw">

        <!-- rudder limits +/-30deg 40 deg/sec-->
        <!-- stabilizer limits +/7deg 30 deg/sec-->
        <!--<fcs_function name="fcs/ari-longitudinal-rudder-demand-norm">
            <description>ARI</description>
            <function>
                <table>
                    <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                    ?? or stick position ??
                    <tableData>
                        -30     0.1
                        0     0
                        30     -0.1
                    </tableData>
                </table>
            </function>
            <clipto>
                <min> -0.1 </min>
                <max>  0.1 </max>
            </clipto>
        </fcs_function>-->

        <switch name="fcs/aileron-cmd-norm-ap-switched">
            <default value="fcs/aileron-cmd-norm"/>
            <test logic="AND" value="autoflight/ss/aileron-norm">
                autoflight/input/roll-switch eq 1
                autoflight/output/roll-master eq 0
            </test>
            <test logic="AND" value="0">
                autoflight/input/roll-switch eq 1
                autoflight/output/roll-master eq 1
            </test>
        </switch>

        <fcs_function name="fcs/ari-lateral-rudder-demand-norm">
            <!--This is the amount of rudder per inch of lateral stick. NASA-TM-72861, Figure 23
                The tables have been normalized to remove the inches of stick movement, based on my understanding that there is about 4inches of stick deflection.-->
            <description>ARI</description>
            <function>
                <product>
                    <property>fcs/aileron-cmd-norm-ap-switched</property>
                    <property>fcs/ari-lateral-enabled</property>
                    <table>
                        <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <independentVar lookup="column">fcs/flap-pos-deg</independentVar>
                        <tableData>
                            0	30
                            -24	-0.923	-0.818
                            0	-0.105	0.000
                            15	0.406	0.511
                        </tableData>
                    </table>
                </product>
            </function>
            <clipto>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </clipto>
        </fcs_function>

        <!-- http://www.f15sim.com/operation/f15_flight_control_system.htm -->
        <switch name="fcs/ari-lateral-rudder-pos-norm">
            <default value="fcs/ari-lateral-rudder-demand-norm"/>
            <test value="0" logic="OR">
                fcs/ari-lateral-enabled eq 0
                velocities/mach ge 0.9
            </test>
            <test value="0" logic="OR">
                velocities/mach ge 0.9
                position/aircraft-on-ground ne 0
                fcs/ari-lateral-enabled eq 0
            </test>
        </switch>

        <summer name="fcs/rudder-command-raw-sum">
            <input>fcs/rudder-cmd-norm</input>
            <input>fcs/yaw-trim-cmd-norm</input>
            <input>fcs/ari-lateral-rudder-pos-norm</input>
            <clipto>
                <min> -1 </min>
                <max>  1 </max>
            </clipto>
        </summer>
        <pure_gain name="fcs/rudder-command-sum">
            <input>fcs/rudder-command-raw-sum</input>
            <gain>systems/cadc/rudder-effectivity</gain>
        </pure_gain >

        <summer name="Rudder Sum">
            <input>fcs/rudder-command-sum</input>
            <input>fcs/yaw-damper-dmd</input>
            <clipto>
                <min> -1.1 </min>
                <max>  1.1 </max>
            </clipto>
        </summer>

        <switch name="fcs/rudder-actuator-pos">
            <default value="fcs/rudder-sum"/>
        </switch>
        <kinematic name="Rudder Control">
            <input>fcs/rudder-actuator-pos</input>
            <traverse>
                <setting>
                    <position>-0.35</position>
                    <time>0.2857</time>
                </setting>
                <setting>
                    <position>0.35</position>
                    <time>0.2857</time>
                </setting>
            </traverse>
            <output>fcs/rudder-pos-rad</output>
        </kinematic>

        <aerosurface_scale name="rudder normalization">
            <input>fcs/rudder-pos-rad</input>
            <domain>
                <min> -0.35 </min>
                <max>  0.35 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max>  1 </max>
            </range>
            <output>fcs/rudder-pos-norm</output>
        </aerosurface_scale>
    </channel>

    <channel name="Flaps">
        <switch name="fcs/flap-total-dmd">
            <default value="0"/>
            <test value="fcs/flap-total-dmd">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="fcs/flap-cmd-norm">
                fcs/flap-cmd-norm ne 0
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max>  1 </max>
            </clipto>
            <output>fcs/flap-total-dmd</output>
        </switch>

        <kinematic name="Flaps Control">
            <input>fcs/flap-total-dmd</input>
            <traverse>
                <setting>
                    <position>  0 </position>
                    <time>      0 </time>
                </setting>
                <setting>
                    <position> 30 </position>
                    <time>    1.944</time>
                </setting>
            </traverse>
            <output>fcs/flap-pos-deg</output>
        </kinematic>

        <aerosurface_scale name="flap normalization">
            <input>fcs/flap-pos-deg</input>
            <domain>
                <min>  0 </min>
                <max> 30 </max>
            </domain>
            <range>
                <min> 0 </min>
                <max> 1 </max>
            </range>
            <output>fcs/flap-pos-norm</output>
        </aerosurface_scale>


    </channel>

    <channel name="Landing Gear">
<!-- landing gear;
1. Switch up down
2. emergency handle

- normal operation (emergency handle retracted).
  : requires hyds
  : cannot retract on ground
  
  parts:
    uplock
    downlock
    door
    bogeys
    
    uplock downlock modelled as single lock -ve for downlock 0 for unlocked, 1 for uplocked
    
emerg operation.
: handle pulled. hyds & electrics cut
-->
        <!--<pure_gain name="gear/unit[0]/pos-norm">
            <description>Landing gear unit 0 position</description>
            <input>gear/gear-pos-norm</input>
            <gain> 1</gain>
        </pure_gain>
        <pure_gain name="gear/unit[1]/pos-norm">
            <description>Landing gear unit 0 position</description>
            <input>gear/gear-pos-norm</input>
            <gain> 1</gain>
        </pure_gain>
        <pure_gain name="gear/unit[2]/pos-norm">
            <description>Landing gear unit 0 position</description>
            <input>gear/gear-pos-norm</input>
            <gain> 1</gain>
        </pure_gain>-->

        <!-- Deplete the JFS store-->
        <switch name="systems/hydraulics/emerg-gear-unlocked">
            <default value="0"/>
            <test value="1">
                systems/hydraulics/util-system-accumulator-psi gt 200
                gear/emergency-handle gt 0.7
                gear/unit[0]/locked ne 0
            </test>
            <test value="systems/hydraulics/emerg-gear-unlocked">
                gear/emergency-handle gt 0.7
            </test>            
        </switch>
        <switch name="systems/hydraulics/emerg-gear-bleed">
            <default value="0"/>
            <test value="10000">
                systems/hydraulics/emerg-gear-unlocked ne 0
                gear/unit[0]/locked ne 0
            </test>
        </switch>

        <switch name="gear/unit[0]/locked">
            <default value="-1"/>
            <test value="0">
                systems/hydraulics/emerg-gear-unlocked ne 0
                <!-- unlocked when handle pulled -->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
                <!-- unlocked. -->
               gear/gear-pos-norm gt 0
               gear/gear-pos-norm lt 1
            </test>
            <test value="1">
               gear/gear-pos-norm le 0
            </test>
            <test value="-1">
               gear/gear-pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/unit[1]/locked">
            <default value="-1"/>
            <test value="0">
                <!-- unlocked when handle pulled -->
                <!-- should deplete the JFS store-->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
                <!-- unlocked. -->
               gear/gear-pos-norm gt 0
               gear/gear-pos-norm lt 1
            </test>
            <test value="1">
               gear/gear-pos-norm le 0
            </test>
            <test value="-1">
               gear/gear-pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/unit[2]/locked">
            <default value="-1"/>
            <test value="0">
                <!-- unlocked when handle pulled -->
                <!-- should deplete the JFS store-->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
                <!-- unlocked. -->
               gear/gear-pos-norm gt 0
               gear/gear-pos-norm lt 1
            </test>
            <test value="1">
               gear/gear-pos-norm le 0
            </test>
            <test value="-1">
               gear/gear-pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/emerg-pos">
            <default value="gear/emerg-pos-dmd"/>
        </switch>
        <fcs_function name="gear/emerg-pos-dmd">
            <function>
                <ifthen>
                    <and>
                        <ge>
                            <property>gear/emergency-handle</property>
                            <value>0.9</value>
                        </ge>
                        <or>
                            <eq>
                                <property>gear/unit[0]/locked</property>
                                <value>-1.0</value>
                            </eq>
                            <and>
                                <eq>
                                    <property>contact/unit[9]/WOW</property>
                                    <value>0</value>
                                </eq>
                                <eq>
                                    <property>contact/unit[10]/WOW</property>
                                    <value>0</value>
                                </eq>
                            </and>
                        </or>
                    </and>
                    <sum>
                        <property>gear/emerg-pos</property>
                        <ifthen><not><property>gear/unit[0]/locked</property><value>1.0</value></not>
                            <table>
                                <independentVar lookup="row">gear/emerg-pos</independentVar>
                                <independentVar lookup="column">accelerations/Nz</independentVar>
                                <tableData>
                                               -3.0     0.0     0.5     1.0     1.2     2.0     5.0    10.0
                                   -0.00001  0.00000 0.00100 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                    0.0     -0.00400 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                    0.90     0.00000 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                    0.98     0.11000 0.00000 0.00000 0.00000 0.00000 0.09000 0.11090 0.00400
                                    1.0      0.00000 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                </tableData>
                            </table>
                            <value>0</value>
                    </ifthen>
                    </sum>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <switch name="gear/unit[0]/damaged">
            <default value="gear/unit[0]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
                <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[0]/WOW ne 0
            </test>
        </switch>
        <switch name="gear/unit[1]/damaged">
            <default value="gear/unit[1]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
            <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[1]/WOW ne 0
            </test>
        </switch>
        <switch name="gear/unit[2]/damaged">
            <default value="gear/unit[2]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
            <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[2]/WOW ne 0
            </test>
        </switch>
        <switch name="Gear Unit 0 Z">
            <default value="-77.6496063"/>
            <test value="-20">
                gear/unit[0]/damaged eq 1
            </test>
            <output>gear/unit[0]/z-position</output>
        </switch>
        <switch name="Gear Unit 1 Z">
            <default value="-84.3385827"/>
            <test value="-30">
                gear/unit[1]/damaged eq 1
            </test>
            <output>gear/unit[1]/z-position</output>
        </switch>
        <switch name="Gear Unit 2 Z">
            <default value="-84.3385827"/>
            <test value="-30">
                gear/unit[2]/damaged eq 1
            </test>
            <output>gear/unit[2]/z-position</output>
        </switch>

        <switch name="Contact Unit 3 Z nose door">
            <default value="-30.6496063"/>
            <test value="-55">
                gear/unit[0]/damaged eq 1
            </test>
            <output>contact/unit[3]/z-position</output>
        </switch>
        <switch name="Contact Unit 4 Z nose door">
            <default value="-30"/>
            <test value="-55">
                gear/unit[1]/damaged eq 1
            </test>
            <output>contact/unit[4]/z-position</output>
        </switch>
        <switch name="Contact Unit 5 Z nose door">
            <default value="-30"/>
            <test value="-55">
                gear/unit[2]/damaged eq 1
            </test>
            <output>contact/unit[5]/z-position</output>
        </switch>
        <switch name="tied/aircraft-on-ground-last-value">
            <default value="position/aircraft-on-ground"/>
            <output>position/aircraft-on-ground-last-value</output>
            <!--<test value="1">
            position/aircraft-on-ground ne 0
        </test>-->
        </switch>
        
        <!--Gear that is damaged will be shown as half retracted; which will look kind of broken. These
        three functions set the gear position based on the damage to the appropriate value-->
        <fcs_function name="tied/fcs-gear-0-pos-norm">
            <function>
                <ifthen>
                    <and>
                        <gt>
                            <p>gear/unit[0]/damaged</p>
                            <v>0</v>
                        </gt>
                        <gt>
                            <p>gear/gear-pos-norm</p>
                            <v>0.6</v>
                        </gt>
                    </and>
                    <v>0.5</v>
                    <p>gear/gear-pos-norm</p>
                </ifthen>
            </function>
            <output>gear/unit[0]/pos-norm</output>
        </fcs_function>

        <fcs_function name="tied/fcs-gear-1-pos-norm">
            <function>
                <ifthen>
                    <and>
                        <gt>
                            <p>gear/unit[1]/damaged</p>
                            <v>0</v>
                        </gt>
                        <gt>
                            <p>gear/gear-pos-norm</p>
                            <v>0.6</v>
                        </gt>
                    </and>
                    <v>0.5</v>
                    <p>gear/gear-pos-norm</p>
                </ifthen>
            </function>
            <output>gear/unit[1]/pos-norm</output>
        </fcs_function>
        
        <fcs_function name="tied/fcs-gear-2-pos-norm">
            <function>
                <ifthen>
                    <and>
                        <gt>
                            <p>gear/unit[2]/damaged</p>
                            <v>0</v>
                        </gt>
                        <gt>
                            <p>gear/gear-pos-norm</p>
                            <v>0.6</v>
                        </gt>
                    </and>
                    <v>0.5</v>
                    <p>gear/gear-pos-norm</p>
                </ifthen>
            </function>
            <output>gear/unit[2]/pos-norm</output>
        </fcs_function>
        <!--End of gear damage handling-->

        <switch name="tied/gear-dmd-norm">
            <default value="1"/>
            <test value="1">
                <!-- always force gear down when on ground - to prevent inadvertant retraction -->
              position/aircraft-on-ground ne 0
            </test>
            <test value="gear/emerg-pos">
              gear/emergency-handle ne 0
            </test>
            <test value="gear/gear-pos-norm">
                gear/serviceable ne 1
                gear/emergency-handle lt 1
            </test>
            <test value="gear/gear-dmd-norm">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="gear/gear-cmd-norm">
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max>  1 </max>
            </clipto>
            <output>gear/gear-dmd-norm</output>
        </switch>

        <kinematic name="Gear Control">
            <input>gear/gear-dmd-norm</input>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time>     0 </time>
                </setting>
                <setting>
                    <position> 1 </position>
                    <time>     1.8 </time>
                </setting>
            </traverse>
            <output>gear/gear-pos-norm</output>
        </kinematic>

        <!--<kinematic name="fcs/steer-pos-deg">
            <input>fcs/steer-cmd-norm</input>
            <traverse>
                <setting>
                    <position>-35</position>
                    <time>1.1</time>
                </setting>
                <setting>
                    <position>35</position>
                    <time>1.1</time>
                </setting>
            </traverse>
            <output>fcs/steer-pos-deg</output>
        </kinematic>-->
    </channel>

    <channel name="Speedbrake">
        <switch name="fcs/speedbrake-dmd-norm">
            <default value="0"/>
            <test value="fcs/speedbrake-dmd-norm">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="fcs/speedbrake-cmd-norm">
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max>  1 </max>
            </clipto>
            <output>fcs/speedbrake-dmd-norm</output>
        </switch>

        <kinematic name="Speedbrake Control">
            <input>fcs/speedbrake-dmd-norm</input>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time>     0 </time>
                </setting>
                <setting>
                    <position> 1 </position>
                    <time>     1.5 </time>
                </setting>
            </traverse>
            <output>fcs/speedbrake-pos-norm</output>
        </kinematic>
    </channel>

    <channel name="Hook">
        <kinematic name="fcs/hook-control">
            <input>fcs/hook-engage</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>2.5</time>
                </setting>
            </traverse>
            <output>fcs/hook-pos-norm</output>
        </kinematic>
    </channel>
</system>
